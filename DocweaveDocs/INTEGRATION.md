# DocWeave - Integration & Architecture Insights

*Generated by DocWeave with GitHub Copilot CLI*

● List directory .
  └ 22 files found

● List directory src
  └ 7 files found

● Read pyproject.toml
  └ 26 lines read

Now let me examine the main CLI and app code:

● List directory src/docweave
  └ 15 files found

● Find Python files in src
  $ find /Users/julian/Documents/DocWeave/src -type f -name "*.py" | head -20
  └ 16 lines...

● Read src/docweave/cli.py
  └ 250 lines read

● Read src/docweave/app.py
  └ 253 lines read

● Read src/docweave/components/copilot_integration.py
  └ 367 lines read

● Read src/docweave/components/doc_generator.py
  └ 273 lines read

● Read src/docweave/lib/repo_utils.py
  └ 70 lines read

● Read src/docweave/types/models.py
  └ 53 lines read

Now I have a complete picture. Let me create a technical guide based on the actual codebase:

● Create ~/.copilot/session-state/fff90fd1-3790-45fe-86cb-09ba7d550eaa/INTEGRATION_GUIDE.md (+113)

## Technical Integration Guide for DocWeave

### Where Integrations are Generated/Configured

Integrations centralize in `src/docweave/components/copilot_integration.py`. The sole external integration is **GitHub Copilot CLI**, invoked via subprocess using `copilot -p "prompt"`. Two constants control behavior: `MAX_DIFF_CHARS=6000` (truncation) and `COPILOT_TIMEOUT=60`. No webhooks or API clients exist yet—DocWeave is Git-only with Copilot as its sole AI dependency. Extension point: define new provider functions in `copilot_integration.py`, wrap in try-except with fallbacks (established pattern), expose via `doc_generator.py`.

### Best Way to Solve Login/Authentication

**Currently:** Zero authentication. CLI accepts any path; web API has no auth checks. GitHub URLs are blocked with helpful errors only.

**Recommended approach:**
- **CLI:** Use environment variables (`DOCWEAVE_TOKEN`) or `~/.docweave/config.yaml` for credentials. Avoid interactive prompts.
- **GitHub:** Implement OAuth2 in FastAPI (`authlib` library) to exchange tokens; validate on each `/api/` request via middleware.
- **Copilot:** Copilot CLI manages its own auth—verify with `check_copilot_cli_installed()` (already implemented).
- **Security:** Create `lib/auth.py` with decorator-based checks. Never hardcode tokens; leverage Copilot's upstream authentication.

### Key Integration Points & Extension Paths

**1. Copilot Analysis** (`copilot_integration.py`): Add new `async def generate_X_with_copilot()` functions. Pattern: prompt → parse JSON → fallback gracefully.

**2. Documentation Generation** (`doc_generator.py`): Add new document generators (e.g., `_generate_security_checklist()`). Wire into `save_documentation()`.

**3. CLI Commands** (`cli.py`): Add `@cli.command()` for new analyses. Same pattern: path detection → Copilot check → analysis → output.

**4. Web API** (`app.py`): Add FastAPI routes wrapping CLI logic. Use Pydantic models for validation.

**5. Repository Detection** (`lib/repo_utils.py`): Extend with `fetch_remote_repo()` and `validate_repo_structure()`.

### Gotchas & Conventions

- **Fallbacks mandatory:** Every Copilot call must degrade gracefully (`_create_fallback_analysis()` pattern).
- **Subprocess safety:** Use `asyncio.create_subprocess_exec()`, never blocking `subprocess.run()`. Enforce timeouts—Copilot hangs.
- **Prompt engineering:** Truncate inputs, request JSON explicitly, include fallback instructions.
- **Data types:** Use `@dataclass` (never dicts for contracts). `CodeAnalysis.importance` must be lowercase.
- **Paths:** Resolve to absolute, validate `.git` early, use `Path` objects internally.
- **No duplication:** Logic in `lib/`/`components/`; CLI and web API both import and call same functions.
- **Async throughout:** All I/O must be async. No blocking calls in async functions.

Saved full guide to session artifacts for reference.
